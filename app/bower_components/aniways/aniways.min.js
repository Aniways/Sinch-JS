/*! Aniways 2014-07-29 */
!function(){function a(){c=window.jQuery.noConflict(!0),b()}function b(){function a(){function a(a){var b=JSON.parse(a);!g||b.version>g.version?(k.extend(h,f,b,e),localStorage.setItem("aniwaysConfiguration",JSON.stringify(h))):k.extend(h,f,g,e)}function b(){console.error("There was a problem with the configuration request. Returned code was "+this.status)}function c(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b}var d="http://api.aniways.com/configuration",e={},f={AWcontextual:!0,AWanalytics:!0,inputImageSize:20,wallImageSize:30,popoverImageSize:50,highlightColor:"lightgreen",encoding:{mapping:{0:"​",1:"‌",2:"‍",3:"﻿"},delimiter:"‌",chunckSize:6},assetsUrl:"http://aniways.blob.core.windows.net/aniways-assets/120/"},g=JSON.parse(localStorage.getItem("aniwaysConfiguration")),h=k.extend(h,f,g);l.getJson(d,null,a,b),this.userConfiguration=function(a){e.inputImageSize=a.inputImageSize,e.popoverImageSize=a.popoverImageSize,e.wallImageSize=a.wallImageSize,e.highlightColor=a.highlightColor,k.extend(h,e)},this.isContextual=function(){return h.AWcontextual},this.isAnalytics=function(){return h.AWanalytics},this.inputImageSize=function(){return h.inputImageSize},this.popoverImageSize=function(){return h.popoverImageSize},this.wallImageSize=function(){return h.wallImageSize},this.versionName=function(){return h.versionName},this.highlightColor=function(){return h.highlightColor},this.encoding=function(){return h.encoding},this.decoding=function(){return c(h.encoding.mapping)},this.assetsUrl=function(){return h.assetsUrl}}function b(a,b){function c(a){for(var b=Object.keys(m).length,c="",d=0;d<a.length;d+=1){var e=m[a.charAt(d)];if(void 0===e)return-1;c+=m[a.charAt(d)]}return parseInt(c,b)}function d(a){for(var b={data:[],message:""},c={},d=a.length,h=0;d>h;h++)void 0!==m[a.charAt(h)]&&(c={},c.phraseStart=h,a=e(c,a,h),a=f(c,"subPhraseStart",a,h),a=g(c,"subPhraseEnd",a,h),a=g(c,"phraseEnd",a,h),b.data.push(c),h=c.phraseEnd,d=a.length);return b.message=a,b}function e(a,d,e){var f=m[d.charAt(e)]*b.encoding().chunckSize+(b.encoding().chunckSize-1),g=d.substr(e+1,f);if(a.imageId=c(g),-1===a.imageId)throw new h("Mallformed image encoding");return d.substr(0,e)+d.substr(e+f+1)}function f(a,c,d,e){if(a[c]=d.indexOf(b.encoding().delimiter,e),-1===a[c])throw new h("Can't find "+c+" delimiter");return d.substr(0,a[c])+d.substr(a[c]+1)}function g(a,c,d,e){var f=d.indexOf(b.encoding().delimiter,e);if(-1===f)throw new h("Can't find "+c+" delimiter");return a[c]=f-1,d.substr(0,f)+d.substr(f+1)}function i(a){if(null===l)return a;for(var c=d(a),e=c.message,f="",g=0,h=0;h<c.data.length;h++){var i=c.data[h],j=b.assetsUrl()+i.imageId+".png";void 0===j?(f+=e.substring(g,i.phraseEnd),g=i.phraseEnd):(f+=e.substring(g,i.subPhraseStart),f+="<img class='aniways-wall-image' style=height:"+b.wallImageSize()+"px; src='"+j+"'  title='"+e.substring(i.subPhraseStart,i.subPhraseEnd+1)+"'>",g=i.subPhraseEnd+1)}return f+=e.substring(g)}function j(a){var c=a.split("﻿﻿\n\n"),d=c[0];if(c.length<=1)return d;var e=k(c[1]),f=0;for(var g in e)e.hasOwnProperty(g)&&-1!==g.indexOf("si")&&f++;for(var h="",i=0,j=0;f>j;j++){var l=b.assetsUrl()+e["id"+j]+".png";h+=d.substring(i,parseInt(e["si"+j])),h+="<img class='aniways-wall-image' style=height:"+b.wallImageSize()+"px; src='"+l+"'  title='"+d.substring(parseInt(e["si"+j]),parseInt(e["si"+j])+parseInt(e["l"+j]))+"'>",i=parseInt(e["l"+j])+parseInt(e["si"+j])}return h+=d.substring(i)}function k(a){a=a.replace(/&amp;/g,"&"),a=a.match(/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/);for(var b=a[0].split("?")[1],c=b.split("&"),d={},e=0;e<c.length;e++){var f=c[e].split("=");d[f[0]]=f[1]}return d}var l=a,m=b.decoding();this.decodeMessage=function(a){try{return i(a)}catch(b){if(b instanceof h)return j(a)}},this.setMapping=function(a){l=a}}function d(a,b,c){this.encodeText=function(){function b(a){for(var c="",e=[].slice.call(k(a)[0].childNodes),f=0;f<e.length;f++){var g=e[f];"IMG"===g.tagName?c+=d(g):3===g.nodeType?c+=g.textContent:-1===g.className.indexOf("popover")&&(c+=b(g))}return c}function d(a){var b=a.src.replace(/^.*[\\\/]/,""),d=b.substr(0,b.indexOf(".")),f=e(d);return f+c.encoding().delimiter+k(a).data("phrase")+c.encoding().delimiter+c.encoding().delimiter}function e(a){var b,d,e=c.encoding().mapping,f=Object.keys(e).length,g=parseInt(a,10).toString(f),i="",j=0,k="",l=0;for(b=0;f>b&&(l=c.encoding().chunckSize-1+b*c.encoding().chunckSize,k=e[b],!(g.length<=l));b++);if(b===f)throw new h("Cannot encode image");for(d=0;l>d;d++)g>0?(j=g%10,i=e[j]+i,g=Math.floor(g/10)):i=e[0]+i;return k+i}return b(a)}}function e(a){if(null===a)return{highlight:function(){return[]}};var b=Object.keys(a.phrasesToIcons);if(b=c.grep(b,function(b){return""!==b&&void 0!==a.phrasesToIcons[b][""]}),b=c.map(b,function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}),0===b.length)return{highlight:function(){return[]}};var d="i",e="("+b.join("|")+")";e="(?:\\b|\\B(?=\\W))"+e+"(?:\\b|\\B(?=\\W)|$)";var h=new RegExp(e,d);this.highlight=function(a){function b(a){for(var b;null!==(b=h.exec(k(a).text()));){var c=document.createElement("span");c.className="aniways-highlight";var d;d=0===b.index?a:a.splitText(b.index),a=d.data.length>b[0].length?d.splitText(b[0].length):document.createTextNode("");var e=d.cloneNode(!0);c.appendChild(e),k(d).replaceWith(c),i.push(c)}}for(var c,d,e=f(a),i=[],j=[].slice.call(a.childNodes),l=0;l<j.length;l++)c=j[l],"SPAN"===c.tagName&&c.className.indexOf("aniways-highlight")>-1&&(d=c.childNodes[0],k(c).replaceWith(d));a.normalize(),j=[].slice.call(a.childNodes);var m;for(l=0;l<j.length;l++)m=j[l],3===m.nodeType&&b(m);return g(a,e),i}}function f(a){var b=rangy.getSelection().getRangeAt(0),c=b.cloneRange();c.selectNodeContents(a),c.setEnd(b.startContainer,b.startOffset);var d=0;c.getNodes().forEach(function(a){"IMG"===a.tagName?d+=1:3===a.nodeType&&(d+=a===c.endContainer?c.endOffset:a.data.length)});var e=d;return{start:e,end:e+b.toString().length}}function g(a,b){var c=0,d=document.createRange();d.setStart(a,0),d.collapse(!0);for(var e,f=[a],g=!1,h=!1;!h&&(e=f.pop());){var i=0;if(3===e.nodeType)i=c+e.length,!g&&b.start>=c&&b.start<=i&&(d.setStart(e,b.start-c),g=!0),g&&b.end>=c&&b.end<=i&&(d.setEnd(e,b.end-c),h=!0),c=i;else if("IMG"===e.tagName){i=c+1;var j,m,n=[].slice.call(e.parentNode.childNodes);if(!g&&b.start>c&&b.start<=i){for(m=0;o<n.length&&(j=n[o],j!==e);o++);d.setStart(e.parentElement,o+1),d.setEnd(e.parentElement,o+1),g=!0}if(g&&b.end===c&&b.end===i){for(m=0;o<n.length&&(j=n[o],j!==e);o++);d.setStart(e.parentElement,o),d.setEnd(e.parentElement,o),h=!0}c=i}else for(var o=e.childNodes.length;o--;)f.push(e.childNodes[o])}var p=window.getSelection(),q=k(d.endContainer).parent();q.hasClass("aniways-highlight")?l.placeCaretAfterNode(q[0]):(p.removeAllRanges(),p.addRange(d))}function h(a){this.message=a}function i(a,b){function c(a){a.forEach(function(a){if("childList"===a.type)for(var b=a.addedNodes,c=0;c<b.length;c++){var e=b[c];d(e)}})}function d(a){if("function"==typeof a.getElementsByClassName){var b;if(b=a.className.indexOf("aniways-message")>-1?[a]:a.getElementsByClassName("aniways-message"),b.length>0){var c=g.decodeMessage(b[0].innerHTML);b[0].innerHTML=c}}}var e=new MutationObserver(c),f={childList:!0,subtree:!0},g=b;e.observe(a[0],f)}function j(a,b){function c(a){var b={};return b.action="message sent",b.text=a,b}function d(a){var b,c=[],d=0;for(d=0;d<a.length;d++){var e={};b=a[d],e.action="sent",e.pharse=b.phrase,e.partToReplace=b.partToReplace,e.iconName=b.iconName,e.fromButton=!1,c.push(e)}return c}function e(a){var b,c=[],d=0;for(d=0;d<a.length;d++){var e={};b=a[d],e.action="suggested",e.pharse=b.phrase,e.partToReplace=b.partToReplace,c.push(e)}return c}function f(a){return a>=0&&10>a?"0"+a.toString():a.toString()}function g(a){return a>=0&&10>a?"00"+a.toString():a>=10&&99>a?"0"+a.toString():a.toString()}function h(a){return a.getUTCFullYear()+"-"+f(1+a.getUTCMonth())+"-"+f(a.getUTCDate())+"T"+f(a.getUTCHours())+":"+f(a.getUTCMinutes())+":"+f(a.getUTCSeconds())+"."+g(a.getUTCMilliseconds())}var i=function(a){this.appId=a,this.APIUrl="https://aniways-analytics.s3.amazonaws.com/Web/"+a+"/"},j=new i(a);this.messageAnalytics=function(a,f,g,i){var k={},l="";k.type="track",k.category="Input",k.userId=a,k.msgid=f,k.timestamp=h(new Date),k.applicationId=j.appId,k.os=navigator.userAgent,k.abTest=b.versionName(),k.keywordsVersion=g,k.message=c(i.message),k.sentEvent=d(i.iconData),k.suggestEvent=e(i.suggestData),l=h(new Date)+"."+a+".json",j.uploadEvent(k,l)},this.tapAnalytics=function(a,c,d,e){var f={},g="";f.type="track",f.category="Input",f.action="tap",f.userId=a,f.messageId=c,f.timestamp=h(new Date),f.pharse=e.phrase,f.partToReplace=e.partToReplace,f.suggestedIconName=e.suggestedIconName,f.keywordsVersion=d,f.abTest=b.versionName(),g=h(new Date)+"."+a+".json",j.uploadEvent(f,g)},this.selectAnalytics=function(a,c,d,e){var f={},g="";f.type="track",f.category="Input",f.action="selected",f.userId=a,f.messageId=c,f.timestamp=h(new Date),f.pharse=e.phrase,f.partToReplace=e.partToReplace,f.iconName=e.iconName,f.keywordsVersion=d,f.abTest=b.versionName(),f.fromButton=!1,g=h(new Date)+"."+a+".json",j.uploadEvent(f,g)},i.prototype.uploadEvent=function(a,c){if(b.isAnalytics()!==!1){var d=this.APIUrl+c,e={};for(var f in a)a.hasOwnProperty(f)&&(e[f]=a[f]);var g={};g["x-amz-acl"]="bucket-owner-full-control",g["x-amz-storage-class"]="REDUCED_REDUNDANCY",g["Content-Type"]="application/json",l.sendXhr("PUT",d,g,null,e)}}}var k=c;"undefined"==typeof WeakMap&&!function(){var a=Object.defineProperty,b=Date.now()%1e9,c=function(){this.name="__st"+(1e9*Math.random()>>>0)+(b++ +"__")};c.prototype={set:function(b,c){var d=b[this.name];d&&d[0]===b?d[1]=c:a(b,this.name,{value:[b,c],writable:!0})},get:function(a){var b;return(b=a[this.name])&&b[0]===a?b[1]:void 0},"delete":function(a){this.set(a,void 0)}},window.WeakMap=c}(),function(a){function b(a){u.push(a),t||(t=!0,q(d))}function c(a){return window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(a)||a}function d(){t=!1;var a=u;u=[],a.sort(function(a,b){return a.uid_-b.uid_});var b=!1;a.forEach(function(a){var c=a.takeRecords();e(a),c.length&&(a.callback_(c,a),b=!0)}),b&&d()}function e(a){a.nodes_.forEach(function(b){var c=p.get(b);c&&c.forEach(function(b){b.observer===a&&b.removeTransientObservers()})})}function f(a,b){for(var c=a;c;c=c.parentNode){var d=p.get(c);if(d)for(var e=0;e<d.length;e++){var f=d[e],g=f.options;if(c===a||g.subtree){var h=b(g);h&&f.enqueue(h)}}}}function g(a){this.callback_=a,this.nodes_=[],this.records_=[],this.uid_=++v}function h(a,b){this.type=a,this.target=b,this.addedNodes=[],this.removedNodes=[],this.previousSibling=null,this.nextSibling=null,this.attributeName=null,this.attributeNamespace=null,this.oldValue=null}function i(a){var b=new h(a.type,a.target);return b.addedNodes=a.addedNodes.slice(),b.removedNodes=a.removedNodes.slice(),b.previousSibling=a.previousSibling,b.nextSibling=a.nextSibling,b.attributeName=a.attributeName,b.attributeNamespace=a.attributeNamespace,b.oldValue=a.oldValue,b}function j(a,b){return w=new h(a,b)}function k(a){return x?x:(x=i(w),x.oldValue=a,x)}function l(){w=x=void 0}function m(a){return a===x||a===w}function n(a,b){return a===b?a:x&&m(a)?x:null}function o(a,b,c){this.observer=a,this.target=b,this.options=c,this.transientObservedNodes=[]}var p=new WeakMap,q=window.msSetImmediate;if(!q){var r=[],s=String(Math.random());window.addEventListener("message",function(a){if(a.data===s){var b=r;r=[],b.forEach(function(a){a()})}}),q=function(a){r.push(a),window.postMessage(s,"*")}}var t=!1,u=[],v=0;g.prototype={observe:function(a,b){if(a=c(a),!b.childList&&!b.attributes&&!b.characterData||b.attributeOldValue&&!b.attributes||b.attributeFilter&&b.attributeFilter.length&&!b.attributes||b.characterDataOldValue&&!b.characterData)throw new SyntaxError;var d=p.get(a);d||p.set(a,d=[]);for(var e,f=0;f<d.length;f++)if(d[f].observer===this){e=d[f],e.removeListeners(),e.options=b;break}e||(e=new o(this,a,b),d.push(e),this.nodes_.push(a)),e.addListeners()},disconnect:function(){this.nodes_.forEach(function(a){for(var b=p.get(a),c=0;c<b.length;c++){var d=b[c];if(d.observer===this){d.removeListeners(),b.splice(c,1);break}}},this),this.records_=[]},takeRecords:function(){var a=this.records_;return this.records_=[],a}};var w,x;o.prototype={enqueue:function(a){var c=this.observer.records_,d=c.length;if(c.length>0){var e=c[d-1],f=n(e,a);if(f)return void(c[d-1]=f)}else b(this.observer);c[d]=a},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(a){var b=this.options;b.attributes&&a.addEventListener("DOMAttrModified",this,!0),b.characterData&&a.addEventListener("DOMCharacterDataModified",this,!0),b.childList&&a.addEventListener("DOMNodeInserted",this,!0),(b.childList||b.subtree)&&a.addEventListener("DOMNodeRemoved",this,!0)},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(a){var b=this.options;b.attributes&&a.removeEventListener("DOMAttrModified",this,!0),b.characterData&&a.removeEventListener("DOMCharacterDataModified",this,!0),b.childList&&a.removeEventListener("DOMNodeInserted",this,!0),(b.childList||b.subtree)&&a.removeEventListener("DOMNodeRemoved",this,!0)},addTransientObserver:function(a){if(a!==this.target){this.addListeners_(a),this.transientObservedNodes.push(a);var b=p.get(a);b||p.set(a,b=[]),b.push(this)}},removeTransientObservers:function(){var a=this.transientObservedNodes;this.transientObservedNodes=[],a.forEach(function(a){this.removeListeners_(a);for(var b=p.get(a),c=0;c<b.length;c++)if(b[c]===this){b.splice(c,1);break}},this)},handleEvent:function(a){switch(a.stopImmediatePropagation(),a.type){case"DOMAttrModified":var b=a.attrName,c=a.relatedNode.namespaceURI,d=a.target,e=new j("attributes",d);e.attributeName=b,e.attributeNamespace=c;var g=a.attrChange===MutationEvent.ADDITION?null:a.prevValue;f(d,function(a){return!a.attributes||a.attributeFilter&&a.attributeFilter.length&&-1===a.attributeFilter.indexOf(b)&&-1===a.attributeFilter.indexOf(c)?void 0:a.attributeOldValue?k(g):e});break;case"DOMCharacterDataModified":var d=a.target,e=j("characterData",d),g=a.prevValue;f(d,function(a){return a.characterData?a.characterDataOldValue?k(g):e:void 0});break;case"DOMNodeRemoved":this.addTransientObserver(a.target);case"DOMNodeInserted":var h,i,d=a.relatedNode,m=a.target;"DOMNodeInserted"===a.type?(h=[m],i=[]):(h=[],i=[m]);var n=m.previousSibling,o=m.nextSibling,e=j("childList",d);e.addedNodes=h,e.removedNodes=i,e.previousSibling=n,e.nextSibling=o,f(d,function(a){return a.childList?e:void 0})}l()}},a.JsMutationObserver=g,a.MutationObserver=g}(this),+function(a){"use strict";var b=function(a,b){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",a,b)};b.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},b.prototype.init=function(b,c,d){this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d);for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focus",i="hover"==g?"mouseleave":"blur";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},b.prototype.getDefaults=function(){return b.DEFAULTS},b.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},b.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},b.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show()},b.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},b.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){if(this.$element.trigger(b),b.isDefaultPrevented())return;var c=this.tip();this.setContent(),this.options.animation&&c.addClass("fade");var d="function"==typeof this.options.placement?this.options.placement.call(this,c[0],this.$element[0]):this.options.placement,e=/\s?auto?\s?/i,f=e.test(d);f&&(d=d.replace(e,"")||"top"),c.detach().css({top:0,left:0,display:"block"}).addClass(d),this.options.container?c.appendTo(this.options.container):c.insertAfter(this.$element);var g=this.getPosition(),h=c[0].offsetWidth,i=c[0].offsetHeight;if(f){var j=this.$element.parent(),k=d,l=document.documentElement.scrollTop||document.body.scrollTop,m="body"==this.options.container?window.innerWidth:j.outerWidth(),n="body"==this.options.container?window.innerHeight:j.outerHeight(),o="body"==this.options.container?0:j.offset().left;d="bottom"==d&&g.top+g.height+i-l>n?"top":"top"==d&&g.top-l-i<0?"bottom":"right"==d&&g.right+h>m?"left":"left"==d&&g.left-h<o?"right":d,c.removeClass(k).addClass(d)}var p=this.getCalculatedOffset(d,g,h,i);this.applyPlacement(p,d),this.$element.trigger("shown.bs."+this.type)}},b.prototype.applyPlacement=function(a,b){var c,d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),a.top=a.top+g,a.left=a.left+h,d.offset(a).addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;if("top"==b&&j!=f&&(c=!0,a.top=a.top+f-j),/bottom|top/.test(b)){var k=0;a.left<0&&(k=-2*a.left,a.left=0,d.offset(a),i=d[0].offsetWidth,j=d[0].offsetHeight),this.replaceArrow(k-e+i,i,"left")}else this.replaceArrow(j-f,j,"top");c&&d.offset(a)},b.prototype.replaceArrow=function(a,b,c){this.arrow().css(c,a?50*(1-a/b)+"%":"")},b.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},b.prototype.hide=function(){function b(){"in"!=c.hoverState&&d.detach()}var c=this,d=this.tip(),e=a.Event("hide.bs."+this.type);return this.$element.trigger(e),e.isDefaultPrevented()?void 0:(d.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?d.one(a.support.transition.end,b).emulateTransitionEnd(150):b(),this.$element.trigger("hidden.bs."+this.type),this)},b.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},b.prototype.hasContent=function(){return this.getTitle()},b.prototype.getPosition=function(){var b=this.$element[0];return a.extend({},"function"==typeof b.getBoundingClientRect?b.getBoundingClientRect():{width:b.offsetWidth,height:b.offsetHeight},this.$element.offset())},b.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d-7,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},b.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},b.prototype.tip=function(){return this.$tip=this.$tip||a(this.options.template)},b.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},b.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},b.prototype.enable=function(){this.enabled=!0},b.prototype.disable=function(){this.enabled=!1},b.prototype.toggleEnabled=function(){this.enabled=!this.enabled},b.prototype.toggle=function(b){var c=b?a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;c.tip().hasClass("in")?c.leave(c):c.enter(c)},b.prototype.destroy=function(){this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var c=a.fn.tooltip;a.fn.tooltip=function(c){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof c&&c;e||d.data("bs.tooltip",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.tooltip.Constructor=b,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=c,this}}(k),+function(a){"use strict";var b=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");b.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),b.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),b.prototype.constructor=b,b.prototype.getDefaults=function(){return b.DEFAULTS},b.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content")[this.options.html?"html":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},b.prototype.hasContent=function(){return this.getTitle()||this.getContent()},b.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},b.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},b.prototype.tip=function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip};var c=a.fn.popover;a.fn.popover=function(c){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof c&&c;e||d.data("bs.popover",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.popover.Constructor=b,a.fn.popover.noConflict=function(){return a.fn.popover=c,this}}(k),!function(a){var b=a.fn.popover.Constructor.prototype.setContent;a.fn.popover.Constructor.prototype.setContent=function(){b.call(this);var a=this.tip();a.find("img").on("load",{self:this},function(b){var c=b.data.self;a.removeClass("fade in top bottom left right");var d,e,f,g;d="function"==typeof c.options.placement?c.options.placement.call(this,a[0],c.$element[0]):c.options.placement;var e=c.getPosition(),f=a[0].offsetWidth,g=a[0].offsetHeight,h=c.getCalculatedOffset(d,e,f,g);if(c.applyPlacement(h,d),c.$tip.attr("contenteditable",!1),c.$tip.addClass("aniways-popover"),c.$element.trigger("shown.bs.shown"),screen.width<480){var i=a.find(".popover-content").width();a.find(".popover-content").width(i+this.width+30)}})}}(k),function(a){a(document).on("change keydown keypress input","*[data-placeholder]",function(){this.textContent?this.setAttribute("data-div-placeholder-content","true"):this.removeAttribute("data-div-placeholder-content")})}(c),function(a){function b(b,c){function d(b){h.logging&&("undefined"!=typeof console?console.log(b):a("body").append("<br /> * "+b))}function e(b){if(b.originalEvent&&"undefined"!=typeof b.originalEvent.touches){if(d("Touchable Touchstart touches length "+b.originalEvent.touches.length),1!==b.originalEvent.touches.length&&2!==b.originalEvent.touches.length)return!1;if(h.isCurrentlyTouching)return!1;h.isCurrentlyTouching=!0,1==b.originalEvent.touches.length?(h.isOneFingerGesture=!0,h.startTouch.x=h.previousTouch.x=b.originalEvent.touches[0].clientX,h.startTouch.y=h.previousTouch.y=b.originalEvent.touches[0].clientY):2==b.originalEvent.touches.length&&(h.isOneFingerGesture=!1,b.originalEvent.touches[0].clientY>b.originalEvent.touches[1].clientY?(h.startTouch.x=h.previousTouch.x=b.originalEvent.touches[0].clientX,h.startTouch.y=h.previousTouch.y=b.originalEvent.touches[0].clientY):(h.startTouch.x=h.previousTouch.x=h.touches[1].clientX,h.startTouch.y=h.previousTouch.y=h.touches[1].clientY))}else d("Touchable Touchstart touches length "+b.pageX+" "+b.pageY),h.startTouch.x=h.previousTouch.x=b.pageX,h.startTouch.y=h.previousTouch.y=b.pageY,a(document).bind("mousemove",f),a(document).bind("mouseup",g);h.target=b.target,h.currentTarget=b.currentTarget;var c=h.startTouch.x,e=h.startTouch.y;h.hitTarget=document.elementFromPoint?document.elementFromPoint(c,e):"",h.inDoubleTap?(d("Touchable doubleTap"),h.$elem.trigger("doubleTap",h),clearTimeout(h.doubleTapTimer),h.inDoubleTap=!1):(h.inDoubleTap=!0,h.doubleTapTimer=setTimeout(function(){h.inDoubleTap=!1},500)),h.longTapTimer=setTimeout(function(){d("Touchable longTap"),a(h.elem).trigger("longTap",h)},1e3),d("Touchable Tap"),a(h.elem).trigger("tap",h),a(h.elem).trigger("touchablestart",h)}function f(b){if(b.originalEvent&&"undefined"!=typeof b.originalEvent.touches){if(d("Touchable Touchsmove touches length "+b.originalEvent.touches.length),1!==b.originalEvent.touches.length&&2!==b.originalEvent.touches.length)return!1;1==b.originalEvent.touches.length||h.isOneFingerGesture?(h.currentTouch.x=b.originalEvent.touches[0].clientX,h.currentTouch.y=b.originalEvent.touches[0].clientY):2!=b.originalEvent.touches.length||h.isOneFingerGesture||(b.originalEvent.touches[0].clientY>b.originalEvent.touches[1].clientY?(h.currentTouch.x=b.originalEvent.touches[0].clientX,h.currentTouch.y=b.originalEvent.touches[0].clientY):(h.currentTouch.x=b.originalEvent.touches[1].clientX,h.currentTouch.y=b.originalEvent.touches[1].clientY))}else b.preventDefault(),h.currentTouch.x=b.pageX,h.currentTouch.y=b.pageY;a(h.elem).removeClass("webkitAnimate"),h.currentDelta.x=h.currentTouch.x-h.previousTouch.x,h.currentDelta.y=h.currentTouch.y-h.previousTouch.y,h.currentStartDelta.x=h.currentTouch.x-h.startTouch.x,h.currentStartDelta.y=h.currentTouch.y-h.startTouch.y,h.currentPosition.x=h.currentPosition.x+h.currentDelta.x,h.currentPosition.y=h.currentPosition.y+h.currentDelta.y,h.previousTouch.x=h.currentTouch.x,h.previousTouch.y=h.currentTouch.y,d("Touchable Touchablemove self e.target"+b.target+"e.currentTarget "+b.currentTarget+" x:"+h.currentStartDelta.x),h.target=b.target,h.currentTarget=b.currentTarget;var c=h.currentTouch.x,e=h.currentTouch.y;h.hitTarget=document.elementFromPoint?document.elementFromPoint(c,e):"",a(h.elem).trigger("touchablemove",h),h.longTapTimer&&clearTimeout(h.longTapTimer)}function g(b){if(b.originalEvent&&"undefined"!=typeof b.originalEvent.touches){if(b.originalEvent.targetTouches.length>0)return!1}else a(document).unbind("mousemove",f),a(document).unbind("mouseup",g);h.isCurrentlyTouching=!1,h.longTapTimer&&clearTimeout(h.longTapTimer),d("Touchable Touchend self "+h.currentStartDelta.x),a(h.elem).trigger("touchableend",h),d("Touchable: touchableend"),d("Touchable: Hittarget click")}this.logging=!1,this.elem=b,this.$elem=a(b),this.is_doubleTap=!1,this.is_currentlyTouching=!1,this.isOneFingerGesture=!1,this.startTouch={x:0,y:0},this.currentTouch={x:0,y:0},this.previousTouch={x:0,y:0},this.currentDelta={x:0,y:0},this.currentStartDelta={x:0,y:0},this.currentPosition={x:0,y:0},this.doubleTapTimer=null,this.longTapTimer=null,this.touchStartSupported=!1;var h=this;"undefined"!=typeof c&&("undefined"!=typeof c.logging&&(this.logging=c.logging),"undefined"!=typeof c.preventClick&&(this.preventClick=c.preventClick)),this.$elem.bind("touchstart",function(a){h.touchStartSupported=!0,e(a)}),this.$elem.bind("mousedown",function(a){return h.touchStartSupported||e(a),!1}),this.$elem.bind("touchmove",f),this.$elem.bind("touchend",g),this.preventClick&&this.$elem.bind("click",function(a){a.preventDefault()})}a.fn.Touchable=function(c){return this.each(function(){var d=a(this).data.Touchable=new b(this,c);return d})},a.fn.newHover=function(b,c){return this.each(function(){a(this).bind("newHoverIn",b).bind("newHoverOut",c)})},a.fn.newHover2=function(b,c){return this.each(function(){a(this).bind("newHoverIn2",b).bind("newHoverOut2",c)})},a.Touchable=b}(c);var l=function(){function a(a){var b=rangy.getSelection(),c=rangy.createRange();c.setStartAfter(a),c.setEndAfter(a),b.removeAllRanges(),b.addRange(c)}function b(){var a=navigator.userAgent.toLowerCase();return a.indexOf("android")>-1}function c(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");return b>0||navigator.userAgent.match(/Trident.*rv\:11\./)?!0:!1}function d(){return"undefined"==typeof XMLHttpRequest?!1:"withCredentials"in new XMLHttpRequest}function e(a,b,c,e,f,g,h){var i;if(e){b+="?";for(var j in e)e.hasOwnProperty(j)&&(b=b+j+"="+e[j]+"&");b+="platform=web"}if(d()){if(i=new XMLHttpRequest,i.open(a,b,!0),c)for(var k in c)c.hasOwnProperty(k)&&i.setRequestHeader(k,c[k])}else("GET"===a||"POST"===a)&&(i=new XDomainRequest,i.open(a,b,!0));i.onreadystatechange=function(){4==i.readyState&&(i.status>=200&&i.status<300?g&&g(i.responseText):(console.log("HTTP request failed."),h&&h(i,null)))};var l=f?JSON.stringify(f):null;i.send(l)}function f(a,b,c,d){e("GET",a,null,b,null,c,d)}return{sendXhr:e,getJson:f,placeCaretAfterNode:a,isAndroid:b,isIE:c}}();window.Aniways=function(){function c(a,c){return s=document.getElementsByClassName("aniways-div")[0],t=new e(v),void 0!==c&&A.userConfiguration(c),q=new b(v,A),void 0===a?(console.log("appId can not be undefined, please specify your appId in the init call"),!1):(l.getJson(x,{sdkVersion:B.version,appId:a},n),r=new j(a,A),document.getElementsByClassName("aniways-wall").length>0?(u=new i(document.getElementsByClassName("aniways-wall"),q),g(),!0):(console.log("Can't find element with aniways-wall class"),!1))}function f(a){a=a||s;var b=new d(a,v,A).encodeText(),c=h(s,b);k(a)[0].innerHTML="",k(a).trigger("change"),z=m();var e;return e=null!==v?v.version:"N/A",r.messageAnalytics(y,z,e,c),b}function g(){function a(){function a(a){a.attr("data-phrase",a.text().toLowerCase()),a.popover({selector:".aniways-highlight",html:!0,placement:"top",content:p(k(a)),trigger:"manual"})}if(A.isContextual()!==!1){var b=t.highlight(this);k.each(b,function(b,c){c=k(c),a(c),c.Touchable()}),k(".aniways-popover:visible").remove(),k(".aniways-highlight").removeClass("clicked")}}l.isIE()?k(".aniways-div").on("keyup",a):k(".aniways-div").on("input",a),k("body").on("click",".aniways-popover-image",function(a){o(a)}),k("body").on("tap",".aniways-highlight",function(a,b){var c=k(b.currentTarget),d=c.next("div.popover"),e=d.is(":visible");k(".aniways-popover:visible").each(function(a,b){var c=k(b).prev();c.popover("hide"),screen.width<480&&k(b).find(".popover-content").width(0),c.removeClass("clicked")}),e||(c.popover("show"),c.addClass("clicked"));var f=c.siblings(".popover.in").find("img.aniways-popover-image"),g={phrase:c.data("phrase"),partToReplace:c.data("phrase"),suggestedIconName:[]};f.each(function(a,b){g.suggestedIconName.push(b.src.replace(/^.*[\\\/]/,""))}),r.tapAnalytics(y,z,v.version,g)}),k(".aniways-div").click(function(){k(this).focus()}),k("body").on("click",function(a){k(".aniways-popover:visible").each(function(){var b=k(this).prev();b.is(a.target)||0!==b.has(a.target).length||0!==k(".popover").has(a.target).length||(b.popover("hide"),b.removeClass("clicked"),screen.width<480&&k(this).find(".popover-content").width(0))})})}function h(a,b){var c={iconData:[],suggestData:[],message:b};return k(a).children(".aniways-image").each(function(a,b){c.iconData.push({phrase:b.attributes["data-phrase"].value,iconName:b.src.replace(/^.*[\\\/]/,""),partToReplace:b.attributes["data-phrase"].value}),c.suggestData.push({phrase:b.attributes["data-phrase"].value,partToReplace:b.attributes["data-phrase"].value})
}),k(a).children(".aniways-highlight").each(function(a,b){c.suggestData.push({phrase:b.attributes["data-phrase"].value,partToReplace:b.attributes["data-phrase"].value})}),c}function m(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})}function n(a){v=JSON.parse(a),localStorage.setItem("aniwaysMappings",JSON.stringify(v)),t=new e(v),q.setMapping(v)}function o(a){var b=k(a.target),c=b.parents(".popover").prev();c.popover("destroy");var d=b.clone();d.removeClass("aniways-popover-image").addClass("aniways-image"),d.css("height",A.inputImageSize()),d.removeAttr("onclick"),c.replaceWith(d),l.placeCaretAfterNode(d[0]),r.selectAnalytics(y,z,v.version,{phrase:d[0].attributes["data-phrase"].value,iconName:d[0].src.replace(/^.*[\\\/]/,""),partToReplace:d[0].attributes["data-phrase"].value})}function p(a){for(var b,c,d="",e=a.data("phrase"),f=v.phrasesToIcons[e][""].length,g=0;f>g;g++)c=v.phrasesToIcons[e][""][g],b=A.assetsUrl()+c+".png",d+="<img class='aniways-popover-image' style=height:"+A.popoverImageSize()+"px; src="+b+" data-phrase="+e+"></img>";return d}var q,r,s,t,u,v=JSON.parse(localStorage.getItem("aniwaysMappings")),w="http://api.aniways.com",x=w+"/v2/keywords",y=localStorage.getItem("aniwaysUserId"),z=m(),A=new a,B={version:"2.3.9"};return null===y&&(y=m(),localStorage.setItem("aniwaysUserId",y)),{init:c,encodeText:f}}(),h.prototype=new Error,h.prototype.constructor=h}var c;if(void 0===window.jQuery||"2.1.0"!==window.jQuery.fn.jquery){var d=document.createElement("script");d.setAttribute("type","text/javascript"),d.setAttribute("src","http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"),d.readyState?d.onreadystatechange=function(){("complete"==this.readyState||"loaded"==this.readyState)&&a()}:d.onload=a,(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(d)}else c=window.jQuery,b()}(),window.rangy=function(){function a(a,b){var c=typeof a[b];return"function"==c||!("object"!=c||!a[b])||"unknown"==c}function b(a,b){return!("object"!=typeof a[b]||!a[b])}function c(a,b){return"undefined"!=typeof a[b]}function d(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&m(a,l)&&o(a,k)}function f(a){window.alert("Rangy not supported in your browser. Reason: "+a),p.initialized=!0,p.supported=!1}function g(){if(!p.initialized){var c,d=!1,g=!1;for(a(document,"createRange")&&(c=document.createRange(),m(c,j)&&o(c,i)&&(d=!0),c.detach()),(c=b(document,"body")?document.body:document.getElementsByTagName("body")[0])&&a(c,"createTextRange")&&(c=c.createTextRange(),e(c)&&(g=!0)),!d&&!g&&f("Neither Range nor TextRange are implemented"),p.initialized=!0,p.features={implementsDomRange:d,implementsTextRange:g},d=r.concat(q),g=0,c=d.length;c>g;++g)try{d[g](p)}catch(h){b(window,"console")&&a(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",h)}}}function h(a){this.name=a,this.supported=this.initialized=!1}var i=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],j=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],k=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],l=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],m=d(a),n=d(b),o=d(c),p={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:b,isHostProperty:c,areHostMethods:m,areHostObjects:n,areHostProperties:o,isTextRange:e},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};p.fail=f,p.warn=function(a){a="Rangy warning: "+a,p.config.alertOnWarn?window.alert(a):"undefined"!=typeof window.console&&"undefined"!=typeof window.console.log&&window.console.log(a)},{}.hasOwnProperty?p.util.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}:f("hasOwnProperty not supported");var q=[],r=[];p.init=g,p.addInitListener=function(a){p.initialized?a(p):q.push(a)};var s=[];p.addCreateMissingNativeApiListener=function(a){s.push(a)},p.createMissingNativeApi=function(a){a=a||window,g();for(var b=0,c=s.length;c>b;++b)s[b](a)},h.prototype.fail=function(a){throw this.initialized=!0,this.supported=!1,Error("Module '"+this.name+"' failed to load: "+a)},h.prototype.warn=function(a){p.warn("Module "+this.name+": "+a)},h.prototype.createError=function(a){return Error("Error in Rangy "+this.name+" module: "+a)},p.createModule=function(a,b){var c=new h(a);p.modules[a]=c,r.push(function(a){b(a,c),c.initialized=!0,c.supported=!0})},p.requireModules=function(a){for(var b,c,d=0,e=a.length;e>d;++d){if(c=a[d],b=p.modules[c],!(b&&b instanceof h))throw Error("Module '"+c+"' not found");if(!b.supported)throw Error("Module '"+c+"' not supported")}};var t=!1;if(n=function(){t||(t=!0,p.initialized||g())},"undefined"==typeof window)f("No window found");else{if("undefined"!=typeof document)return a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",n,!1),a(window,"addEventListener")?window.addEventListener("load",n,!1):a(window,"attachEvent")?window.attachEvent("onload",n):f("Window does not have required addEventListener or attachEvent method"),p;f("No document found")}}(),rangy.createModule("DomUtil",function(a,b){function c(a){for(var b=0;a=a.previousSibling;)b++;return b}function d(a,b){var c,d=[];for(c=a;c;c=c.parentNode)d.push(c);for(c=b;c;c=c.parentNode)if(o(d,c))return c;return null}function e(a,b,c){for(c=c?a:a.parentNode;c;){if(a=c.parentNode,a===b)return c;c=a}return null}function f(a){return a=a.nodeType,3==a||4==a||8==a}function g(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function h(a){if(9==a.nodeType)return a;if("undefined"!=typeof a.ownerDocument)return a.ownerDocument;if("undefined"!=typeof a.document)return a.document;if(a.parentNode)return h(a.parentNode);throw Error("getDocument: no document found for node")}function i(a){return a?f(a)?'"'+a.data+'"':1==a.nodeType?"<"+a.nodeName+(a.id?' id="'+a.id+'"':"")+">["+a.childNodes.length+"]":a.nodeName:"[No node]"}function j(a){this._next=this.root=a}function k(a,b){this.node=a,this.offset=b}function l(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var m=a.util;m.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),m.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var n=document.createElement("div");m.areHostMethods(n,["insertBefore","appendChild","cloneNode"])||b.fail("Incomplete Element implementation"),m.isHostProperty(n,"innerHTML")||b.fail("Element is missing innerHTML property"),n=document.createTextNode("test"),m.areHostMethods(n,["splitText","deleteData","insertData","appendData","cloneNode"])||b.fail("Incomplete Text Node implementation");var o=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};j.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a,b=this._current=this._next;if(this._current)if(a=b.firstChild)this._next=a;else{for(a=null;b!==this.root&&!(a=b.nextSibling);)b=b.parentNode;this._next=a}return this._current},detach:function(){this._current=this._next=this.root=null}},k.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+i(this.node)+":"+this.offset+")]"}},l.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},l.prototype.toString=function(){return this.message},a.dom={arrayContains:o,isHtmlNamespace:function(a){var b;return"undefined"==typeof a.namespaceURI||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b},parentElement:function(a){return a=a.parentNode,1==a.nodeType?a:null},getNodeIndex:c,getNodeLength:function(a){var b;return f(a)?a.length:(b=a.childNodes)?b.length:0},getCommonAncestor:d,isAncestorOf:function(a,b,c){for(b=c?b:b.parentNode;b;){if(b===a)return!0;b=b.parentNode}return!1},getClosestAncestorIn:e,isCharacterDataNode:f,insertAfter:g,splitDataNode:function(a,b){var c=a.cloneNode(!1);return c.deleteData(0,b),a.deleteData(b,a.length-b),g(c,a),c},getDocument:h,getWindow:function(a){if(a=h(a),"undefined"!=typeof a.defaultView)return a.defaultView;if("undefined"!=typeof a.parentWindow)return a.parentWindow;throw Error("Cannot get a window object for node")},getIframeWindow:function(a){if("undefined"!=typeof a.contentWindow)return a.contentWindow;if("undefined"!=typeof a.contentDocument)return a.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element")},getIframeDocument:function(a){if("undefined"!=typeof a.contentDocument)return a.contentDocument;if("undefined"!=typeof a.contentWindow)return a.contentWindow.document;throw Error("getIframeWindow: No Document object found for iframe element")},getBody:function(a){return m.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]},getRootContainer:function(a){for(var b;b=a.parentNode;)a=b;return a},comparePoints:function(a,b,f,g){var h;if(a==f)return b===g?0:g>b?-1:1;if(h=e(f,a,!0))return b<=c(h)?-1:1;if(h=e(a,f,!0))return c(h)<g?-1:1;if(b=d(a,f),a=a===b?b:e(a,b,!0),f=f===b?b:e(f,b,!0),a===f)throw Error("comparePoints got to case 4 and childA and childB are the same!");for(b=b.firstChild;b;){if(b===a)return-1;if(b===f)return 1;b=b.nextSibling}throw Error("Should not be here!")},inspectNode:i,fragmentFromNodeChildren:function(a){for(var b,c=h(a).createDocumentFragment();b=a.firstChild;)c.appendChild(b);return c},createIterator:function(a){return new j(a)},DomPosition:k},a.DOMException=l}),rangy.createModule("DomRange",function(a){function b(a,b){return 3!=a.nodeType&&(I.isAncestorOf(a,b.startContainer,!0)||I.isAncestorOf(a,b.endContainer,!0))}function c(a){return I.getDocument(a.startContainer)}function d(a,b,c){if(b=a._listeners[b])for(var d=0,e=b.length;e>d;++d)b[d].call(a,{target:a,args:c})}function e(a){return new J(a.parentNode,I.getNodeIndex(a))}function f(a){return new J(a.parentNode,I.getNodeIndex(a)+1)}function g(a,b,c){var d=11==a.nodeType?a.firstChild:a;return I.isCharacterDataNode(b)?c==b.length?I.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:I.splitDataNode(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]),d}function h(a){for(var b,d,e=c(a.range).createDocumentFragment();d=a.next();){if(b=a.isPartiallySelectedSubtree(),d=d.cloneNode(!b),b&&(b=a.getSubtreeIterator(),d.appendChild(h(b)),b.detach(!0)),10==d.nodeType)throw new K("HIERARCHY_REQUEST_ERR");e.appendChild(d)}return e}function i(a,b,c){var d,e;for(c=c||{stop:!1};d=a.next();)if(a.isPartiallySelectedSubtree()){if(b(d)===!1)return void(c.stop=!0);if(d=a.getSubtreeIterator(),i(d,b,c),d.detach(!0),c.stop)return}else for(d=I.createIterator(d);e=d.next();)if(b(e)===!1)return void(c.stop=!0)}function j(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),j(b),b.detach(!0)):a.remove()}function k(a){for(var b,d,e=c(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),d=a.getSubtreeIterator(),b.appendChild(k(d)),d.detach(!0)):a.remove(),10==b.nodeType)throw new K("HIERARCHY_REQUEST_ERR");e.appendChild(b)}return e}function l(a,b,c){var d,e=!(!b||!b.length),f=!!c;e&&(d=RegExp("^("+b.join("|")+")$"));var g=[];return i(new n(a,!1),function(a){e&&!d.test(a.nodeType)||f&&!c(a)||g.push(a)}),g}function m(a){return"["+("undefined"==typeof a.getName?"Range":a.getName())+"("+I.inspectNode(a.startContainer)+":"+a.startOffset+", "+I.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function n(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&I.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||I.isCharacterDataNode(this.sc)?I.getClosestAncestorIn(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||I.isCharacterDataNode(this.ec)?I.getClosestAncestorIn(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function o(a){this.code=this[a],this.codeName=a,this.message="RangeException: "+this.codeName}function p(a,b,c){this.nodes=l(a,b,c),this._next=this.nodes[0],this._position=0}function q(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){if(d=e.nodeType,I.arrayContains(a,d))return e;e=e.parentNode}return null}}function r(a,b){if(S(a,b))throw new o("INVALID_NODE_TYPE_ERR")}function s(a){if(!a.startContainer)throw new K("INVALID_STATE_ERR")}function t(a,b){if(!I.arrayContains(b,a.nodeType))throw new o("INVALID_NODE_TYPE_ERR")}function u(a,b){if(0>b||b>(I.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new K("INDEX_SIZE_ERR")}function v(a,b){if(Q(a,!0)!==Q(b,!0))throw new K("WRONG_DOCUMENT_ERR")}function w(a){if(R(a,!0))throw new K("NO_MODIFICATION_ALLOWED_ERR")}function x(a,b){if(!a)throw new K(b)}function y(a){return!!a.startContainer&&!!a.endContainer&&!(!I.arrayContains(M,a.startContainer.nodeType)&&!Q(a.startContainer,!0))&&!(!I.arrayContains(M,a.endContainer.nodeType)&&!Q(a.endContainer,!0))&&a.startOffset<=(I.isCharacterDataNode(a.startContainer)?a.startContainer.length:a.startContainer.childNodes.length)&&a.endOffset<=(I.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length)}function z(a){if(s(a),!y(a))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}function A(){}function B(a){a.START_TO_START=X,a.START_TO_END=Y,a.END_TO_END=Z,a.END_TO_START=$,a.NODE_BEFORE=_,a.NODE_AFTER=ab,a.NODE_BEFORE_AND_AFTER=bb,a.NODE_INSIDE=cb}function C(a){B(a),B(a.prototype)}function D(a,b){return function(){z(this);var c=this.startContainer,d=this.startOffset,e=this.commonAncestorContainer,g=new n(this,!0);return c!==e&&(c=I.getClosestAncestorIn(c,e,!0),d=f(c),c=d.node,d=d.offset),i(g,w),g.reset(),e=a(g),g.detach(),b(this,c,d,c,d),e}}function E(c,d,g){function h(a,b){return function(c){s(this),t(c,L),t(P(c),M),c=(a?e:f)(c),(b?i:l)(this,c.node,c.offset)}}function i(a,b,c){var e=a.endContainer,f=a.endOffset;(b!==a.startContainer||c!==a.startOffset)&&((P(b)!=P(e)||1==I.comparePoints(b,c,e,f))&&(e=b,f=c),d(a,b,c,e,f))}function l(a,b,c){var e=a.startContainer,f=a.startOffset;(b!==a.endContainer||c!==a.endOffset)&&((P(b)!=P(e)||-1==I.comparePoints(b,c,e,f))&&(e=b,f=c),d(a,e,f,b,c))}c.prototype=new A,a.util.extend(c.prototype,{setStart:function(a,b){s(this),r(a,!0),u(a,b),i(this,a,b)},setEnd:function(a,b){s(this),r(a,!0),u(a,b),l(this,a,b)},setStartBefore:h(!0,!0),setStartAfter:h(!1,!0),setEndBefore:h(!0,!1),setEndAfter:h(!1,!1),collapse:function(a){z(this),a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){s(this),r(a,!0),d(this,a,0,a,I.getNodeLength(a))},selectNode:function(a){s(this),r(a,!1),t(a,L);var b=e(a);a=f(a),d(this,b.node,b.offset,a.node,a.offset)},extractContents:D(k,d),deleteContents:D(j,d),canSurroundContents:function(){z(this),w(this.startContainer),w(this.endContainer);var a=new n(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);return a.detach(),!c},detach:function(){g(this)},splitBoundaries:function(){z(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,f=a===c;I.isCharacterDataNode(c)&&e>0&&e<c.length&&I.splitDataNode(c,e),I.isCharacterDataNode(a)&&b>0&&b<a.length&&(a=I.splitDataNode(a,b),f?(e-=b,c=a):c==a.parentNode&&e>=I.getNodeIndex(a)&&e++,b=0),d(this,a,b,c,e)},normalizeBoundaries:function(){z(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,f=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(c=a,e=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},g=function(d){var f=d.previousSibling;if(f&&f.nodeType==d.nodeType){a=d;var g=d.length;b=f.length,d.insertData(0,f.data),f.parentNode.removeChild(f),a==c?(e+=b,c=a):c==d.parentNode&&(f=I.getNodeIndex(d),e==f?(c=d,e=g):e>f&&e--)}},h=!0;I.isCharacterDataNode(c)?c.length==e&&f(c):(e>0&&(h=c.childNodes[e-1])&&I.isCharacterDataNode(h)&&f(h),h=!this.collapsed),h?I.isCharacterDataNode(a)?0==b&&g(a):b<a.childNodes.length&&(f=a.childNodes[b])&&I.isCharacterDataNode(f)&&g(f):(a=c,b=e),d(this,a,b,c,e)},collapseToPoint:function(a,b){s(this),r(a,!0),u(a,b),(a!==this.startContainer||b!==this.startOffset||a!==this.endContainer||b!==this.endOffset)&&d(this,a,b,a,b)}}),C(c)}function F(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:I.getCommonAncestor(a.startContainer,a.endContainer)}function G(a,b,c,e,f){var g=a.startContainer!==b||a.startOffset!==c,h=a.endContainer!==e||a.endOffset!==f;a.startContainer=b,a.startOffset=c,a.endContainer=e,a.endOffset=f,F(a),d(a,"boundarychange",{startMoved:g,endMoved:h})}function H(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},F(this)}a.requireModules(["DomUtil"]);var I=a.dom,J=I.DomPosition,K=a.DOMException;n.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,I.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a,b,c=this._current;!I.isCharacterDataNode(c)||c!==this.sc&&c!==this.ec?c.parentNode&&c.parentNode.removeChild(c):(a=c===this.sc?this.so:0,b=c===this.ec?this.eo:c.length,a!=b&&c.deleteData(a,b-a))},isPartiallySelectedSubtree:function(){return b(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new H(c(this.range));var b=this._current,d=b,e=0,f=b,g=I.getNodeLength(b);I.isAncestorOf(b,this.sc,!0)&&(d=this.sc,e=this.so),I.isAncestorOf(b,this.ec,!0)&&(f=this.ec,g=this.eo),G(a,d,e,f,g)}return new n(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},o.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},o.prototype.toString=function(){return this.message},p.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var L=[1,3,4,5,7,8,10],M=[2,9,11],N=[1,3,4,5,7,8,10,11],O=[1,3,4,5,7,8],P=I.getRootContainer,Q=q([9,11]),R=q([5,6,10,12]),S=q([6,10,12]),T=document.createElement("style"),U=!1;try{T.innerHTML="<b>x</b>",U=3==T.firstChild.nodeType}catch(V){}a.features.htmlParsingConforms=U;var W=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],X=0,Y=1,Z=2,$=3,_=0,ab=1,bb=2,cb=3;A.prototype={attachListener:function(a,b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,b){z(this),v(this.startContainer,b.startContainer);var c=a==$||a==X?"start":"end",d=a==Y||a==X?"start":"end";return I.comparePoints(this[c+"Container"],this[c+"Offset"],b[d+"Container"],b[d+"Offset"])},insertNode:function(a){if(z(this),t(a,N),w(this.startContainer),I.isAncestorOf(a,this.startContainer,!0))throw new K("HIERARCHY_REQUEST_ERR");this.setStartBefore(g(a,this.startContainer,this.startOffset))},cloneContents:function(){z(this);var a,b;return this.collapsed?c(this).createDocumentFragment():this.startContainer===this.endContainer&&I.isCharacterDataNode(this.startContainer)?(a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=c(this).createDocumentFragment(),b.appendChild(a),b):(b=new n(this,!0),a=h(b),b.detach(),a)},canSurroundContents:function(){z(this),w(this.startContainer),w(this.endContainer);var a=new n(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);return a.detach(),!c},surroundContents:function(a){if(t(a,O),!this.canSurroundContents())throw new o("BAD_BOUNDARYPOINTS_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);g(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){z(this);for(var a,b=new H(c(this)),d=W.length;d--;)a=W[d],b[a]=this[a];return b},toString:function(){z(this);var a=this.startContainer;if(a===this.endContainer&&I.isCharacterDataNode(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[];return a=new n(this,!0),i(a,function(a){(3==a.nodeType||4==a.nodeType)&&b.push(a.data)}),a.detach(),b.join("")},compareNode:function(a){z(this);var b=a.parentNode,c=I.getNodeIndex(a);if(!b)throw new K("NOT_FOUND_ERR");return a=this.comparePoint(b,c),b=this.comparePoint(b,c+1),0>a?b>0?bb:_:b>0?ab:cb},comparePoint:function(a,b){return z(this),x(a,"HIERARCHY_REQUEST_ERR"),v(a,this.startContainer),I.comparePoints(a,b,this.startContainer,this.startOffset)<0?-1:I.comparePoints(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:U?function(a){var b=this.startContainer,c=I.getDocument(b);if(!b)throw new K("INVALID_STATE_ERR");var d=null;return 1==b.nodeType?d=b:I.isCharacterDataNode(b)&&(d=I.parentElement(b)),d=null===d||"HTML"==d.nodeName&&I.isHtmlNamespace(I.getDocument(d).documentElement)&&I.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1),d.innerHTML=a,I.fragmentFromNodeChildren(d)}:function(a){s(this);var b=c(this).createElement("body");return b.innerHTML=a,I.fragmentFromNodeChildren(b)},toHtml:function(){z(this);var a=c(this).createElement("div");return a.appendChild(this.cloneContents()),a.innerHTML},intersectsNode:function(a,b){if(z(this),x(a,"NOT_FOUND_ERR"),I.getDocument(a)!==c(this))return!1;var d=a.parentNode,e=I.getNodeIndex(a);x(d,"NOT_FOUND_ERR");var f=I.comparePoints(d,e,this.endContainer,this.endOffset);return d=I.comparePoints(d,e+1,this.startContainer,this.startOffset),b?0>=f&&d>=0:0>f&&d>0},isPointInRange:function(a,b){return z(this),x(a,"HIERARCHY_REQUEST_ERR"),v(a,this.startContainer),I.comparePoints(a,b,this.startContainer,this.startOffset)>=0&&I.comparePoints(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a,b){if(z(this),c(a)!=c(this))throw new K("WRONG_DOCUMENT_ERR");var d=I.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),e=I.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return b?0>=d&&e>=0:0>d&&e>0},intersection:function(a){if(this.intersectsRange(a)){var b=I.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=I.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return-1==b&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();return-1==I.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset),1==I.comparePoints(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new o("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==cb},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,I.getNodeLength(a))<=0},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);return c.length>0?(b.setStart(c[0],0),a=c.pop(),b.setEnd(a,a.length),a=this.containsRange(b),b.detach(),a):this.containsNodeContents(a)},createNodeIterator:function(a,b){return z(this),new p(this,a,b)},getNodes:function(a,b){return z(this),l(this,a,b)},getDocument:function(){return c(this)},collapseBefore:function(a){s(this),this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){s(this),this.setStartAfter(a),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return H.rangesEqual(this,a)},isValid:function(){return y(this)},inspect:function(){return m(this)}},E(H,G,function(a){s(a),a.startContainer=a.startOffset=a.endContainer=a.endOffset=null,a.collapsed=a.commonAncestorContainer=null,d(a,"detach",null),a._listeners=null}),a.rangePrototype=A.prototype,H.rangeProperties=W,H.RangeIterator=n,H.copyComparisonConstants=C,H.createPrototypeRange=E,H.inspect=m,H.getRangeDocument=c,H.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset},a.DomRange=H,a.RangeException=o}),rangy.createModule("WrappedRange",function(a){function b(a,b,c,d){var g=a.duplicate();g.collapse(c);var h=g.parentElement();if(e.isAncestorOf(b,h,!0)||(h=b),!h.canHaveHTML)return new f(h.parentNode,e.getNodeIndex(h));b=e.getDocument(h).createElement("span");var i,j=c?"StartToStart":"StartToEnd";do h.insertBefore(b,b.previousSibling),g.moveToElementText(b);while((i=g.compareEndPoints(j,a))>0&&b.previousSibling);if(j=b.nextSibling,-1==i&&j&&e.isCharacterDataNode(j)){if(g.setEndPoint(c?"EndToStart":"EndToEnd",a),/[\r\n]/.test(j.data))for(h=g.duplicate(),c=h.text.replace(/\r\n/g,"\r").length,c=h.moveStart("character",c);-1==h.compareEndPoints("StartToEnd",h);)c++,h.moveStart("character",1);else c=g.text.length;h=new f(j,c)}else j=(d||!c)&&b.previousSibling,h=(c=(d||c)&&b.nextSibling)&&e.isCharacterDataNode(c)?new f(c,0):j&&e.isCharacterDataNode(j)?new f(j,j.length):new f(h,e.getNodeIndex(b));return b.parentNode.removeChild(b),h}function c(a,b){var c,d,f=a.offset,g=e.getDocument(a.node),h=g.body.createTextRange(),i=e.isCharacterDataNode(a.node);return i?(c=a.node,d=c.parentNode):(c=a.node.childNodes,c=f<c.length?c[f]:null,d=a.node),g=g.createElement("span"),g.innerHTML="&#feff;",c?d.insertBefore(g,c):d.appendChild(g),h.moveToElementText(g),h.collapse(!b),d.removeChild(g),i&&h[b?"moveStart":"moveEnd"]("character",f),h}a.requireModules(["DomUtil","DomRange"]);var d,e=a.dom,f=e.DomPosition,g=a.DomRange;if(!a.features.implementsDomRange||a.features.implementsTextRange&&a.config.preferTextRange){if(a.features.implementsTextRange){d=function(a){this.textRange=a,this.refresh()},d.prototype=new g(document),d.prototype.refresh=function(){var a,c,d=this.textRange;a=d.parentElement();var f=d.duplicate();f.collapse(!0),c=f.parentElement(),f=d.duplicate(),f.collapse(!1),d=f.parentElement(),c=c==d?c:e.getCommonAncestor(c,d),c=c==a?c:e.getCommonAncestor(a,c),0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?c=a=b(this.textRange,c,!0,!0):(a=b(this.textRange,c,!0,!1),c=b(this.textRange,c,!1,!1)),this.setStart(a.node,a.offset),this.setEnd(c.node,c.offset)},g.copyComparisonConstants(d);var h=function(){return this}();"undefined"==typeof h.Range&&(h.Range=d),a.createNativeRange=function(a){return a=a||document,a.body.createTextRange()}}}else!function(){function b(a){for(var b,c=i.length;c--;)b=i[c],a[b]=a.nativeRange[b]}var c,f,h,i=g.rangeProperties;d=function(a){if(!a)throw Error("Range must be specified");this.nativeRange=a,b(this)},g.createPrototypeRange(d,function(a,b,c,d,e){var f=a.endContainer!==d||a.endOffset!=e;(a.startContainer!==b||a.startOffset!=c||f)&&(a.setEnd(d,e),a.setStart(b,c))},function(a){a.nativeRange.detach(),a.detached=!0;for(var b,c=i.length;c--;)b=i[c],a[b]=null}),c=d.prototype,c.selectNode=function(a){this.nativeRange.selectNode(a),b(this)},c.deleteContents=function(){this.nativeRange.deleteContents(),b(this)},c.extractContents=function(){var a=this.nativeRange.extractContents();return b(this),a},c.cloneContents=function(){return this.nativeRange.cloneContents()},c.surroundContents=function(a){this.nativeRange.surroundContents(a),b(this)},c.collapse=function(a){this.nativeRange.collapse(a),b(this)},c.cloneRange=function(){return new d(this.nativeRange.cloneRange())},c.refresh=function(){b(this)},c.toString=function(){return this.nativeRange.toString()};var j=document.createTextNode("test");e.getBody(document).appendChild(j);var k=document.createRange();k.setStart(j,0),k.setEnd(j,0);try{k.setStart(j,1),f=!0,c.setStart=function(a,c){this.nativeRange.setStart(a,c),b(this)},c.setEnd=function(a,c){this.nativeRange.setEnd(a,c),b(this)},h=function(a){return function(c){this.nativeRange[a](c),b(this)}}}catch(l){f=!1,c.setStart=function(a,c){try{this.nativeRange.setStart(a,c)}catch(d){this.nativeRange.setEnd(a,c),this.nativeRange.setStart(a,c)}b(this)},c.setEnd=function(a,c){try{this.nativeRange.setEnd(a,c)}catch(d){this.nativeRange.setStart(a,c),this.nativeRange.setEnd(a,c)}b(this)},h=function(a,c){return function(d){try{this.nativeRange[a](d)}catch(e){this.nativeRange[c](d),this.nativeRange[a](d)}b(this)}}}c.setStartBefore=h("setStartBefore","setEndBefore"),c.setStartAfter=h("setStartAfter","setEndAfter"),c.setEndBefore=h("setEndBefore","setStartBefore"),c.setEndAfter=h("setEndAfter","setStartAfter"),k.selectNodeContents(j),c.selectNodeContents=k.startContainer==j&&k.endContainer==j&&0==k.startOffset&&k.endOffset==j.length?function(a){this.nativeRange.selectNodeContents(a),b(this)}:function(a){this.setStart(a,0),this.setEnd(a,g.getEndOffset(a))},k.selectNodeContents(j),k.setEnd(j,3),f=document.createRange(),f.selectNodeContents(j),f.setEnd(j,4),f.setStart(j,2),c.compareBoundaryPoints=-1==k.compareBoundaryPoints(k.START_TO_END,f)&1==k.compareBoundaryPoints(k.END_TO_START,f)?function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)},a.util.isHostMethod(k,"createContextualFragment")&&(c.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),e.getBody(document).removeChild(j),k.detach(),f.detach()}(),a.createNativeRange=function(a){return a=a||document,a.createRange()};a.features.implementsTextRange&&(d.rangeToTextRange=function(a){if(a.collapsed)return c(new f(a.startContainer,a.startOffset),!0);var b=c(new f(a.startContainer,a.startOffset),!0),d=c(new f(a.endContainer,a.endOffset),!1);return a=e.getDocument(a.startContainer).body.createTextRange(),a.setEndPoint("StartToStart",b),a.setEndPoint("EndToEnd",d),a}),d.prototype.getName=function(){return"WrappedRange"},a.WrappedRange=d,a.createRange=function(b){return b=b||document,new d(a.createNativeRange(b))},a.createRangyRange=function(a){return a=a||document,new g(a)},a.createIframeRange=function(b){return a.createRange(e.getIframeDocument(b))},a.createIframeRangyRange=function(b){return a.createRangyRange(e.getIframeDocument(b))},a.addCreateMissingNativeApiListener(function(b){b=b.document,"undefined"==typeof b.createRange&&(b.createRange=function(){return a.createRange(this)}),b=b=null})}),rangy.createModule("WrappedSelection",function(a,b){function c(a){return(a||window).getSelection()}function d(a){return(a||window).document.selection}function e(a,b,c){var d=c?"end":"start";
c=c?"start":"end",a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[c+"Container"],a.focusOffset=b[c+"Offset"]}function f(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function g(b){var c;return b instanceof t?(c=b._selectionNativeRange,c||(c=a.createNativeRange(r.getDocument(b.startContainer)),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=c,b.attachListener("detach",function(){this._selectionNativeRange=null}))):b instanceof u?c=b.nativeRange:a.features.implementsDomRange&&b instanceof r.getWindow(b.startContainer).Range&&(c=b),c}function h(a){var b,c=a.getNodes();a:if(c.length&&1==c[0].nodeType){b=1;for(var d=c.length;d>b;++b)if(!r.isAncestorOf(c[0],c[b])){b=!1;break a}b=!0}else b=!1;if(!b)throw Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function i(a,b){var c=new u(b);a._ranges=[c],e(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function j(b){if(b._ranges.length=0,"None"==b.docSelection.type)f(b);else{var c=b.docSelection.createRange();if(c&&"undefined"!=typeof c.text)i(b,c);else{b.rangeCount=c.length;for(var d,g=r.getDocument(c.item(0)),h=0;h<b.rangeCount;++h)d=a.createRange(g),d.selectNode(c.item(h)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,e(b,b._ranges[b.rangeCount-1],!1)}}}function k(a,b){var c=a.docSelection.createRange(),d=h(b),e=r.getDocument(c.item(0));e=r.getBody(e).createControlRange();for(var f=0,g=c.length;g>f;++f)e.add(c.item(f));try{e.add(d)}catch(i){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}e.select(),j(a)}function l(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function m(a,b){var c=r.getDocument(b[0].startContainer);c=r.getBody(c).createControlRange();for(var d,e=0;rangeCount>e;++e){d=h(b[e]);try{c.add(d)}catch(f){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}c.select(),j(a)}function n(a,b){if(a.anchorNode&&r.getDocument(a.anchorNode)!==r.getDocument(b))throw new v("WRONG_DOCUMENT_ERR")}function o(a){var b=[],c=new w(a.anchorNode,a.anchorOffset),d=new w(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;g>f;++f)b[f]=t.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]),a.config.checkSelectionRanges=!0;var p,q,r=a.dom,s=a.util,t=a.DomRange,u=a.WrappedRange,v=a.DOMException,w=r.DomPosition,x=a.util.isHostMethod(window,"getSelection"),y=a.util.isHostObject(document,"selection"),z=y&&(!x||a.config.preferTextRange);z?(p=d,a.isSelectionValid=function(a){a=(a||window).document;var b=a.selection;return"None"!=b.type||r.getDocument(b.createRange().parentElement())==a}):x?(p=c,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected."),a.getNativeSelection=p,x=p();var A=a.createNativeRange(document),B=r.getBody(document),C=s.areHostObjects(x,s.areHostProperties(x,["anchorOffset","focusOffset"]));a.features.selectionHasAnchorAndFocus=C;var D=s.isHostMethod(x,"extend");a.features.selectionHasExtend=D;var E="number"==typeof x.rangeCount;a.features.selectionHasRangeCount=E;var F=!1,G=!0;s.areHostMethods(x,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof x.rangeCount&&a.features.implementsDomRange&&function(){var a=document.createElement("iframe");a.frameBorder=0,a.style.position="absolute",a.style.left="-10000px",B.appendChild(a);var b=r.getIframeDocument(a);b.open(),b.write("<html><head></head><body>12</body></html>"),b.close();var c=r.getIframeWindow(a).getSelection(),d=b.documentElement.lastChild.firstChild;b=b.createRange(),b.setStart(d,1),b.collapse(!0),c.addRange(b),G=1==c.rangeCount,c.removeAllRanges();var e=b.cloneRange();b.setStart(d,0),e.setEnd(d,2),c.addRange(b),c.addRange(e),F=2==c.rangeCount,b.detach(),e.detach(),B.removeChild(a)}(),a.features.selectionSupportsMultipleRanges=F,a.features.collapsedNonEditableSelectionsSupported=G;var H,I=!1;B&&s.isHostMethod(B,"createControlRange")&&(H=B.createControlRange(),s.areHostProperties(H,["item","add"])&&(I=!0)),a.features.implementsControlRange=I,q=C?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var J;if(s.isHostMethod(x,"getRangeAt")?J=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:C&&(J=function(b){var c=r.getDocument(b.anchorNode);return c=a.createRange(c),c.setStart(b.anchorNode,b.anchorOffset),c.setEnd(b.focusNode,b.focusOffset),c.collapsed!==this.isCollapsed&&(c.setStart(b.focusNode,b.focusOffset),c.setEnd(b.anchorNode,b.anchorOffset)),c}),a.getSelection=function(a){a=a||window;var b=a._rangySelection,c=p(a),e=y?d(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh(a)):(b=new l(c,e,a),a._rangySelection=b),b},a.getIframeSelection=function(b){return a.getSelection(r.getIframeWindow(b))},H=l.prototype,!z&&C&&s.areHostMethods(x,["removeAllRanges","addRange"])){H.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),f(this)};var K=function(b,c){var d=t.getRangeDocument(c);d=a.createRange(d),d.collapseToPoint(c.endContainer,c.endOffset),b.nativeSelection.addRange(g(d)),b.nativeSelection.extend(c.startContainer,c.startOffset),b.refresh()};H.addRange=E?function(b,c){if(I&&y&&"Control"==this.docSelection.type)k(this,b);else if(c&&D)K(this,b);else{var d;F?d=this.rangeCount:(this.removeAllRanges(),d=0),this.nativeSelection.addRange(g(b)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==d+1?(a.config.checkSelectionRanges&&(d=J(this.nativeSelection,this.rangeCount-1))&&!t.rangesEqual(d,b)&&(b=new u(d)),this._ranges[this.rangeCount-1]=b,e(this,b,N(this.nativeSelection)),this.isCollapsed=q(this)):this.refresh()}}:function(a,b){b&&D?K(this,a):(this.nativeSelection.addRange(g(a)),this.refresh())},H.setRanges=function(a){if(I&&a.length>1)m(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;c>b;++b)this.addRange(a[b])}}}else{if(!(s.isHostMethod(x,"empty")&&s.isHostMethod(A,"select")&&I&&z))return b.fail("No means of selecting a Range or TextRange was found"),!1;H.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=r.getDocument(this.anchorNode);else if("Control"==this.docSelection.type){var b=this.docSelection.createRange();b.length&&(a=r.getDocument(b.item(0)).body.createTextRange())}a&&(a.body.createTextRange().select(),this.docSelection.empty())}}catch(c){}f(this)},H.addRange=function(a){"Control"==this.docSelection.type?k(this,a):(u.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,e(this,a,!1))},H.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?m(this,a):b&&this.addRange(a[0])}}H.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new v("INDEX_SIZE_ERR");return this._ranges[a]};var L;if(z)L=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=r.getBody(b.win.document).createTextRange(),c.collapse(!0)),"Control"==b.docSelection.type?j(b):c&&"undefined"!=typeof c.text?i(b,c):f(b)};else if(s.isHostMethod(x,"getRangeAt")&&"number"==typeof x.rangeCount)L=function(b){if(I&&y&&"Control"==b.docSelection.type)j(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;d>c;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));e(b,b._ranges[b.rangeCount-1],N(b.nativeSelection)),b.isCollapsed=q(b)}else f(b)};else{if(!C||"boolean"!=typeof x.isCollapsed||"boolean"!=typeof A.collapsed||!a.features.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;L=function(a){var b;b=a.nativeSelection,b.anchorNode?(b=J(b,0),a._ranges=[b],a.rangeCount=1,b=a.nativeSelection,a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset,a.isCollapsed=q(a)):f(a)}}H.refresh=function(a){var b=a?this._ranges.slice(0):null;if(L(this),a){if(a=b.length,a!=this._ranges.length)return!1;for(;a--;)if(!t.rangesEqual(b[a],this._ranges[a]))return!1;return!0}};var M=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var e=0,g=c.length;g>e;++e)d||b!==c[e]?a.addRange(c[e]):d=!0;a.rangeCount||f(a)};H.removeRange=I?function(a){if("Control"==this.docSelection.type){var b=this.docSelection.createRange();a=h(a);var c=r.getDocument(b.item(0));c=r.getBody(c).createControlRange();for(var d,e=!1,f=0,g=b.length;g>f;++f)d=b.item(f),d!==a||e?c.add(b.item(f)):e=!0;c.select(),j(this)}else M(this,a)}:function(a){M(this,a)};var N;!z&&C&&a.features.implementsDomRange?(N=function(a){var b=!1;return a.anchorNode&&(b=1==r.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b},H.isBackwards=function(){return N(this)}):N=H.isBackwards=function(){return!1},H.toString=function(){for(var a=[],b=0,c=this.rangeCount;c>b;++b)a[b]=""+this._ranges[b];return a.join("")},H.collapse=function(b,c){n(this,b);var d=a.createRange(r.getDocument(b));d.collapseToPoint(b,c),this.removeAllRanges(),this.addRange(d),this.isCollapsed=!0},H.collapseToStart=function(){if(!this.rangeCount)throw new v("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},H.collapseToEnd=function(){if(!this.rangeCount)throw new v("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},H.selectAllChildren=function(b){n(this,b);var c=a.createRange(r.getDocument(b));c.selectNodeContents(b),this.removeAllRanges(),this.addRange(c)},H.deleteFromDocument=function(){if(I&&y&&"Control"==this.docSelection.type){for(var a,b=this.docSelection.createRange();b.length;)a=b.item(0),b.remove(a),a.parentNode.removeChild(a);this.refresh()}else if(this.rangeCount){b=this.getAllRanges(),this.removeAllRanges(),a=0;for(var c=b.length;c>a;++a)b[a].deleteContents();this.addRange(b[c-1])}},H.getAllRanges=function(){return this._ranges.slice(0)},H.setSingleRange=function(a){this.setRanges([a])},H.containsNode=function(a,b){for(var c=0,d=this._ranges.length;d>c;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1},H.toHtml=function(){var a="";if(this.rangeCount){a=t.getRangeDocument(this._ranges[0]).createElement("div");for(var b=0,c=this._ranges.length;c>b;++b)a.appendChild(this._ranges[b].cloneContents());a=a.innerHTML}return a},H.getName=function(){return"WrappedSelection"},H.inspect=function(){return o(this)},H.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null},l.inspect=o,a.Selection=l,a.selectionPrototype=H,a.addCreateMissingNativeApiListener(function(b){"undefined"==typeof b.getSelection&&(b.getSelection=function(){return a.getSelection(this)}),b=null})});